module.exports=function(t){function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var o=e(1),r=i(o);n.default=r.default},function(t,n,e){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var o=e(2),r=i(o),s=void 0,c=void 0,u=function(t){return function(n){return function(e){var i=e;switch(i.type){case"CABLECAR_INITIALIZED":case"CABLECAR_CONNECTED":case"CABLECAR_DISCONNECTED":return n(i);case"CABLECAR_DESTROY":return c&&c.unsubscribe(i.channel),t.getState();case"CABLECAR_DESTROY_ALL":return c&&c.unsubscribeAll(),t.getState();case"CABLECAR_CHANGE_CHANNEL":return c&&c.changeChannel(i.newChannel,i.params),t.getState();default:return c&&c.allows(i)&&i.channel&&!i.CableCar__Action?c.running.indexOf(i.channel)>-1?(c.send(i.channel,i),i.optimistic?n(i):t.getState()):(console.error("CableCar: Dropped action!","Attempting to dispatch an action but cable car is not running.",i,"optimisticOnFail: "+c.options.optimisticOnFail),c.options.optimisticOnFail?n(i):t.getState()):n(i)}}}};u.connect=function(t,n){if(!s)try{s=e(3)}catch(t){throw new Error("CableCar: No actionCableProvider set and 'actioncable' Node package failed to load: "+t)}return c=new r.default(s,t,n),{changeChannel:c.changeChannel.bind(c),getChannels:c.getChannels.bind(c),perform:c.perform.bind(c),send:c.send.bind(c),unsubscribe:c.unsubscribe.bind(c),subscribe:c.subscribe.bind(c)}},u.setProvider=function(t){s=t},n.default=u},function(t,n){"use strict";function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},r=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),s=function(){function t(n,i){var r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e(this,t),this.initialized=function(t){return r.dispatch({type:"CABLECAR_INITIALIZED",channel:t})},this.connected=function(t){r.dispatch({type:"CABLECAR_CONNECTED",channel:t});var n=r.running.indexOf(t);n===-1&&r.running.push(t),r.options.connected&&r.options.connected.call(t)},this.disconnected=function(t){r.dispatch({type:"CABLECAR_DISCONNECTED",channel:t});var n=r.running.indexOf(t);n>-1&&(r.running[n]=r.running[r.running.length-1],r.running.pop()),r.options.disconnected&&r.options.disconnected.call(t)},this.received=function(t,n){r.dispatch(o({},t,{channel:n}))},this.rejected=function(t){throw new Error("CableCar: Attempt to connect was rejected.\n      (Channel: "+t+")")},"undefined"==typeof n)throw new Error("CableCar: unknown ActionCable provider: "+n);if("undefined"==typeof i||"undefined"==typeof i.dispatch)throw new Error("CableCar: unknown store: "+i);this.actionCableProvider=n,this.store=i;var c={prefix:"RAILS",optimisticOnFail:!1};this.initialize(Object.assign(c,s))}return r(t,[{key:"initialize",value:function(t){this.options=t,this.running=[],this.subscriptions={},this.consumer=this.actionCableProvider.createConsumer(t.wsURL)}},{key:"subscribe",value:function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.subscriptions[t]=this.consumer.subscriptions.create(Object.assign({channel:t},e),{initialized:function(){return n.initialized(t)},connected:function(){return n.connected(t)},disconnected:function(){return n.disconnected(t)},received:function(e){return n.received(e,t)},rejected:function(){return n.rejected(t)}})}},{key:"dispatch",value:function(t){var n=Object.assign(t,{CableCar__Action:!0});this.store.dispatch(n)}},{key:"allows",value:function(t){if("object"!==("undefined"==typeof t?"undefined":i(t))||"string"!=typeof t.type)throw new Error("CableCar: "+t+" is not a valid redux action ({ type: ... })");return this.matchPrefix(t.type)}},{key:"matchPrefix",value:function(t){var n=t.slice(0,this.options.prefix.length);return n===this.options.prefix}},{key:"changeChannel",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.subscriptions[t])throw new Error("CableCar: Unknown Channel "+t+" to change Channel");this.unsubscribe(t),this.subscribe(t,n)}},{key:"getChannels",value:function(){return Object.keys(this.subscriptions)}},{key:"perform",value:function(t,n,e){if(!this.subscriptions[t])throw new Error("CableCar: Unknown Channel "+t+" to call perform "+n);this.subscriptions[t].perform(n,e)}},{key:"send",value:function(t,n){if(!this.subscriptions[t])throw new Error("CableCar: Unknown Channel "+t+" to send "+n.type);this.subscriptions[t].send(n)}},{key:"unsubscribe",value:function(t){this.subscriptions[t]&&(this.subscriptions[t].unsubscribe(),delete this.subscriptions[t],this.disconnected(t))}},{key:"unsubscribeAll",value:function(){var t=this;Object.keys(this.subscriptions).forEach(function(n){t.unsubscribe(n)})}}]),t}();n.default=s},function(t,n,e){var i,o;(function(){var r=this;(function(){(function(){var t=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},WebSocket:window.WebSocket,logger:window.console,createConsumer:function(t){var n;return null==t&&(t=null!=(n=this.getConfig("url"))?n:this.INTERNAL.default_mount_path),new s.Consumer(this.createWebSocketURL(t))},getConfig:function(t){var n;return n=document.head.querySelector("meta[name='action-cable-"+t+"']"),null!=n?n.getAttribute("content"):void 0},createWebSocketURL:function(t){var n;return t&&!/^wss?:/i.test(t)?(n=document.createElement("a"),n.href=t,n.href=n.href,n.protocol=n.protocol.replace("http","ws"),n.href):t},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var n,e;if(n=1<=arguments.length?t.call(arguments,0):[],this.debugging)return n.push(Date.now()),(e=this.logger).log.apply(e,["[ActionCable]"].concat(t.call(n)))}}}).call(this)}).call(r);var s=r.ActionCable;(function(){(function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};s.ConnectionMonitor=function(){function n(n){this.connection=n,this.visibilityDidChange=t(this.visibilityDidChange,this),this.reconnectAttempts=0}var e,i,o;return n.pollInterval={min:3,max:30},n.staleThreshold=6,n.prototype.start=function(){if(!this.isRunning())return this.startedAt=i(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),s.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},n.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=i(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),s.log("ConnectionMonitor stopped")},n.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},n.prototype.recordPing=function(){return this.pingedAt=i()},n.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,s.log("ConnectionMonitor recorded connect")},n.prototype.recordDisconnect=function(){return this.disconnectedAt=i(),s.log("ConnectionMonitor recorded disconnect")},n.prototype.startPolling=function(){return this.stopPolling(),this.poll()},n.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},n.prototype.poll=function(){return this.pollTimeout=setTimeout(function(t){return function(){return t.reconnectIfStale(),t.poll()}}(this),this.getPollInterval())},n.prototype.getPollInterval=function(){var t,n,i,o;return o=this.constructor.pollInterval,i=o.min,n=o.max,t=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*e(t,i,n))},n.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return s.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+o(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?s.log("ConnectionMonitor skipping reopening recent disconnect"):(s.log("ConnectionMonitor reopening"),this.connection.reopen())},n.prototype.connectionIsStale=function(){var t;return o(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},n.prototype.disconnectedRecently=function(){return this.disconnectedAt&&o(this.disconnectedAt)<this.constructor.staleThreshold},n.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout(function(t){return function(){if(t.connectionIsStale()||!t.connection.isOpen())return s.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),t.connection.reopen()}}(this),200)},i=function(){return(new Date).getTime()},o=function(t){return(i()-t)/1e3},e=function(t,n,e){return Math.max(n,Math.min(e,t))},n}()}).call(this),function(){var t,n,e,i,o,r,c=[].slice,u=function(t,n){return function(){return t.apply(n,arguments)}},l=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1};i=s.INTERNAL,n=i.message_types,e=i.protocols,o=2<=e.length?c.call(e,0,t=e.length-1):(t=0,[]),r=e[t++],s.Connection=function(){function t(t){this.consumer=t,this.open=u(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new s.ConnectionMonitor(this),this.disconnected=!0}return t.reopenDelay=500,t.prototype.send=function(t){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(t)),!0)},t.prototype.open=function(){return this.isActive()?(s.log("Attempted to open WebSocket, but existing socket is "+this.getState()),!1):(s.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+e),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new s.WebSocket(this.consumer.url,e),this.installEventHandlers(),this.monitor.start(),!0)},t.prototype.close=function(t){var n,e;if(n=(null!=t?t:{allowReconnect:!0}).allowReconnect,n||this.monitor.stop(),this.isActive())return null!=(e=this.webSocket)?e.close():void 0},t.prototype.reopen=function(){var t;if(s.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(n){return t=n,s.log("Failed to reopen WebSocket",t)}finally{s.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},t.prototype.getProtocol=function(){var t;return null!=(t=this.webSocket)?t.protocol:void 0},t.prototype.isOpen=function(){return this.isState("open")},t.prototype.isActive=function(){return this.isState("open","connecting")},t.prototype.isProtocolSupported=function(){var t;return t=this.getProtocol(),l.call(o,t)>=0},t.prototype.isState=function(){var t,n;return n=1<=arguments.length?c.call(arguments,0):[],t=this.getState(),l.call(n,t)>=0},t.prototype.getState=function(){var t,n,e;for(n in WebSocket)if(e=WebSocket[n],e===(null!=(t=this.webSocket)?t.readyState:void 0))return n.toLowerCase();return null},t.prototype.installEventHandlers=function(){var t,n;for(t in this.events)n=this.events[t].bind(this),this.webSocket["on"+t]=n},t.prototype.uninstallEventHandlers=function(){var t;for(t in this.events)this.webSocket["on"+t]=function(){}},t.prototype.events={message:function(t){var e,i,o,r;if(this.isProtocolSupported())switch(o=JSON.parse(t.data),e=o.identifier,i=o.message,r=o.type,r){case n.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case n.ping:return this.monitor.recordPing();case n.confirmation:return this.subscriptions.notify(e,"connected");case n.rejection:return this.subscriptions.reject(e);default:return this.subscriptions.notify(e,"received",i)}},open:function(){if(s.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return s.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(t){if(s.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return s.log("WebSocket onerror event")}},t}()}.call(this),function(){var t=[].slice;s.Subscriptions=function(){function n(t){this.consumer=t,this.subscriptions=[]}return n.prototype.create=function(t,n){var e,i,o;return e=t,i="object"==typeof e?e:{channel:e},o=new s.Subscription(this.consumer,i,n),this.add(o)},n.prototype.add=function(t){return this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.sendCommand(t,"subscribe"),t},n.prototype.remove=function(t){return this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t},n.prototype.reject=function(t){var n,e,i,o,r;for(i=this.findAll(t),o=[],n=0,e=i.length;n<e;n++)r=i[n],this.forget(r),this.notify(r,"rejected"),o.push(r);return o},n.prototype.forget=function(t){var n;return this.subscriptions=function(){var e,i,o,r;for(o=this.subscriptions,r=[],e=0,i=o.length;e<i;e++)n=o[e],n!==t&&r.push(n);return r}.call(this),t},n.prototype.findAll=function(t){var n,e,i,o,r;for(i=this.subscriptions,o=[],n=0,e=i.length;n<e;n++)r=i[n],r.identifier===t&&o.push(r);return o},n.prototype.reload=function(){var t,n,e,i,o;for(e=this.subscriptions,i=[],t=0,n=e.length;t<n;t++)o=e[t],i.push(this.sendCommand(o,"subscribe"));return i},n.prototype.notifyAll=function(){var n,e,i,o,r,s,c;for(e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],r=this.subscriptions,s=[],i=0,o=r.length;i<o;i++)c=r[i],s.push(this.notify.apply(this,[c,e].concat(t.call(n))));return s},n.prototype.notify=function(){var n,e,i,o,r,s,c;for(s=arguments[0],e=arguments[1],n=3<=arguments.length?t.call(arguments,2):[],c="string"==typeof s?this.findAll(s):[s],r=[],i=0,o=c.length;i<o;i++)s=c[i],r.push("function"==typeof s[e]?s[e].apply(s,n):void 0);return r},n.prototype.sendCommand=function(t,n){var e;return e=t.identifier,this.consumer.send({command:n,identifier:e})},n}()}.call(this),function(){s.Subscription=function(){function t(t,e,i){this.consumer=t,null==e&&(e={}),this.identifier=JSON.stringify(e),n(this,i)}var n;return t.prototype.perform=function(t,n){return null==n&&(n={}),n.action=t,this.send(n)},t.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},t.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},n=function(t,n){var e,i;if(null!=n)for(e in n)i=n[e],t[e]=i;return t},t}()}.call(this),function(){s.Consumer=function(){function t(t){this.url=t,this.subscriptions=new s.Subscriptions(this),this.connection=new s.Connection(this)}return t.prototype.send=function(t){return this.connection.send(t)},t.prototype.connect=function(){return this.connection.open()},t.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},t.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},t}()}.call(this)}).call(this),"object"==typeof t&&t.exports?t.exports=s:(i=s,o="function"==typeof i?i.call(n,e,n,t):i,!(void 0!==o&&(t.exports=o)))}).call(this)}]);
//# sourceMappingURL=redux-cablecar.min.js.map